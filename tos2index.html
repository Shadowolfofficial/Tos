<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>macOS Style Page</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            overflow: hidden;
            background: url("https://picsum.photos/1920/1080");
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }
        .taskbar {
            position: absolute;
            bottom: 15px;
            width: auto;
            height: 60px;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 25px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        .dock {
            display: flex;
            gap: 15px;
            padding: 0 15px;
        }
.dock-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
}

.dock-icon {
    width: 100px;
    height: 100px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

        .dock-icon:hover {
            transform: scale(1.1);
        }

        .minimized-indicator {
            position: absolute;
            bottom: -5px;
            width: 4px;
            height: 4px;
            background-color: white;
            border-radius: 50%;
        }
        .color-picker {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            display: none;
            z-index: 1000;
        }
        .window {
            position: absolute;
            top: 50px;
            left: 50px;
            width: 80%;
            height: 80%;
            max-width: 100vw;
            max-height: calc(100vh - 70px);
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 100;
            resize: both;
        }
        .window-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f0f0f0;
            padding: 5px 10px;
            cursor: move;
            height: 25px;
        }
.window-buttons {
    display: flex;
    gap: 8px;
}
.button {
    width: 13px;
    height: 13px;
    border-radius: 50%;
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease;
}
.close { background: #ff5f56; }
.minimize { background: #ffbd2e; }
.maximize { background: #27c93f; }
.button::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    transition: opacity 0.2s ease;
}
.close::before {
    content: "×";
    font-size: 14px;
    color: #660000;
}
.minimize::before {
    content: "−";
    font-size: 14px;
    color: #995500;
}
.maximize::before {
    content: "+";
    font-size: 14px;
    color: #006600;
}
.button:hover::before {
    opacity: 1;
}
        .window-content {
            flex-grow: 1;
            position: relative;
            width: 100%;
            height: calc(100% - 30px);
            overflow: hidden;
        }
        .window-content iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
.clock-container {
    text-align: center;
    margin-top: 20px;
}
.clock {
    font-size: 48px;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}
.date {
    font-size: 16px;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    margin-top: 10px;
}

        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: transparent;
            cursor: nwse-resize;
        }
        .resize-handle-se { bottom: 0; right: 0; }
        .resize-handle-sw { bottom: 0; left: 0; cursor: nesw-resize; }
        .resize-handle-ne { top: 0; right: 0; cursor: nesw-resize; }
        .resize-handle-nw { top: 0; left: 0; cursor: nwse-resize; }
        
        .app-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
}
.app-icons {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}
.app-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
}
.app-icon img {
    width: 50px;
    height: 50px;
    margin-bottom: 5px;
    border-radius: 10px;
}
.app-icon span {
    color: white;
    font-size: 12px;
}
.tos-logo {
    width: 250px;
    height: auto;
    margin-top: 20px;
}
        .dock-icon {
            transition: all 0.3s ease;
        }

        .dock-icon.dragging {
            opacity: 0.5;
            transform: scale(1.1);
        }

        .dock-icon.drag-over {
            transform: scale(1.2);
        }

        @keyframes slide-in {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .dock-icon.new-position {
            animation: slide-in 0.3s ease forwards;
        }
.crypto-widget {
    width: 300px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    backdrop-filter: blur(4px);
    border: 1px solid rgba(255, 255, 255, 0.18);
}

.crypto-item {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.crypto-logo {
    width: 20px;
    height: 20px;
    margin-right: 10px;
    border-radius: 50%;
}

.crypto-name {
    font-weight: bold;
    margin-right: 10px;
}

.crypto-price {
    margin-left: auto;
    font-weight: bold;
}
@media (min-width: 768px) {
  body {
    padding-left: 20px;
  }
  
  .clock-container {
    text-align: left;
    position: absolute;
    left: 20px;
    top: 20px;
  }
}

.sidebar-iframe {
  display: none;
  position: fixed;
  top: 0;
  right: 0;
  width: 300px;
  height: 100vh;
  border: none;
  z-index: 50;
}

@media (min-width: 768px) {
  body {
    padding-right: 300px;
  }
  
  .sidebar-iframe {
    display: block;
  }
}


@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

body > * {
  animation: fadeInUp 0.4s ease-out forwards;
  opacity: 0;
}

body > *:nth-child(1) { animation-delay: 0.05s; }
body > *:nth-child(2) { animation-delay: 0.1s; }
body > *:nth-child(3) { animation-delay: 0.15s; }
body > *:nth-child(4) { animation-delay: 0.2s; }
body > *:nth-child(5) { animation-delay: 0.25s; }
.settings-content {
    padding: 20px;
}

.settings-group {
    margin-bottom: 20px;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 8px;
}

.settings-group h3 {
    margin-bottom: 10px;
}

.settings-group input,
.settings-group textarea,
.settings-group button {
    margin-top: 10px;
}

.settings-group button {
    background: #007AFF;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
}

.settings-group button:hover {
    background: #0056b3;
}
@keyframes unlock {
    0% { opacity: 0; transform: scale(0.8); }
    100% { opacity: 1; transform: scale(1); }
}

body.unlocking > * {
    animation: unlock 0.5s ease-out forwards;
}


.security-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.security-popup {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
}

.security-popup h3 {
    margin-bottom: 15px;
}

.security-popup input {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.button-container {
    display: flex;
    justify-content: space-between;
}

.security-popup button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.security-popup button:first-child {
    background-color: #4CAF50;
    color: white;
}

.security-popup button:last-child {
    background-color: #f44336;
    color: white;
}

.security-popup button:hover {
    opacity: 0.8;
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.security-overlay {
    animation: fadeIn 0.3s ease-out;
}

/* Style général */
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f9;
    color: #333;
}

/* Fenêtre */
.window-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #2c3e50;
    color: #ecf0f1;
    padding: 10px 15px;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

.window-buttons {
    display: flex;
    gap: 8px;
}

.button {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    cursor: pointer;
}

.button.close {
    background-color: #e74c3c;
}

.button.minimize {
    background-color: #f1c40f;
}

.button.maximize {
    background-color: #2ecc71;
}

.window-content {
    background: #ffffff;
    padding: 20px;
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.settings-content h2 {
    font-size: 1.5em;
    margin-bottom: 10px;
    color: #2c3e50;
}

.settings-content h3 {
    font-size: 1.2em;
    margin-top: 20px;
    color: #34495e;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
}

input[type="checkbox"] {
    margin-right: 10px;
}

input[type="password"],
input[type="color"] {
    display: block;
    margin-top: 8px;
    padding: 10px;
    width: calc(100% - 24px);
    max-width: 400px;
    border: 1px solid #bdc3c7;
    border-radius: 4px;
    font-size: 1em;
}

button {
    margin-top: 10px;
    padding: 10px 15px;
    background-color: #3498db;
    color: #ffffff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s ease;
}

button:hover {
    background-color: #2980b9;
}

/* Réactions au changement de couleur */
input[type="color"] {
    width: 50px;
    height: 40px;
    padding: 0;
    border: none;
    cursor: pointer;
}

/* Bouton à bascule */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 25px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 25px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 17px;
    width: 17px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #2ecc71;
}

input:checked + .slider:before {
    transform: translateX(24px);
}
.dock {
    display: flex;
    gap: 15px;
}

.dock-icon {
    width: 45px;
    height: 45px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.dock-icon:hover {
    transform: scale(1.1);
}


.calendar-body {
  text-align: center;
}

#dayOfWeek {
  font-size: 10px;
  margin: 0;
  color: #ff3b30;
  font-weight: 600;
  text-transform: uppercase;
}

#currentDate {
  font-size: 25px;
  font-weight: bold;
  margin: 0;
  color: #1c1c1e;
  line-height: 1;
}
    </style>
</head>
<body>
<iframe src="./menuos.html" class="sidebar-iframe" sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-same-origin allow-scripts allow-top-navigation-by-user-activation" allow="camera; microphone; fullscreen;" style="border:0px #ffffff none;" name="MenuOs" scrolling="no" frameborder="1" marginheight="0px" marginwidth="0px" height="670px" width="450px" allowfullscreen></iframe>
<div class="clock-container">
    <div id="clock" class="clock"></div>
    <div id="date" class="date"></div>
</div>
<div id="crypto-widget" class="crypto-widget"></div>
<div class="app-container">
<div class="app-icons">
    <div class="app-icon" data-app="Reset" onclick="resetDockAndWallpaper()">
        <img src="reload.png">
        <span>Reset</span>
    </div>
    <div class="app-icon" data-app="discord" onclick="createNewWindow('discord')">
        <img src="ThunderOs Apps/Discord.png">
        <span>Discord</span>
    </div>
    <div class="app-icon" data-app="frogiedroid" onclick="createNewWindow('ubgdroid')">
        <img src="https://ubgus.net/logo.png">
        <span>UBGDroid</span>
    </div>
    <div class="app-icon" data-app="AppShop" onclick="createNewWindow('appshop')">
        <img src="ThunderOs Apps/Appshop.png">
        <span>AppShop</span>
    </div>
</div>
    <img src="ThunderOs-rb.png" onclick="window.location.href='./blank.html'" class="tos-logo">
</div>

    <div class="taskbar">
        <div class="dock">
            <div class="dock-icon" data-app="VoltAI" onclick="createNewWindow('voltai')">
                <img src="VoltAI.png">
            </div>
            <div class="dock-icon" data-app="AppShop" onclick="createNewWindow('appshop')">
                <img src="ThunderOs Apps/Appshop.png">
            </div>
            <div class="dock-icon" data-app="settings" onclick="createNewWindow('settings')">
                <img src="icon/settings.png">
            </div>
         <div class="dock-icon">
  <div class="calendar-body">
    <p id="dayOfWeek"></p>
    <h1 id="currentDate"></h1>
  </div>
</div>
<script>
function getDayOfWeek(dayIndex) {
  const daysOfWeek = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
  return daysOfWeek[dayIndex];
}

const currentDate = new Date();
document.getElementById('dayOfWeek').innerText = getDayOfWeek(currentDate.getDay());
document.getElementById('currentDate').innerText = currentDate.getDate();
</script>
            <div class="dock-icon" data-app="Information" onclick="createNewWindow('information')">
                <img src="./information.png">
            </div>
            <div class="dock-icon" data-app="ThunderBrows" onclick="createNewWindow('thunderbrows')">
                <img src="https://raw.githack.com/Shadowolfofficial/appshop/main/Logo%20apps/ThunderBrows.png">
            </div>
            <div class="dock-icon" data-app="Myinstants" onclick="createNewWindow('myinstants')">
                <img src="https://raw.githack.com/Shadowolfofficial/appshop/main/Logo%20apps/myinstants.png">
            </div>
            <div class="dock-icon" onclick="window.location.href='https://raw.githack.com/Shadowolfofficial/appshop/main/thunderbrows.html?baseUrl=s9age'">
                <img src="ThunderOs Apps/soundpage.png">
            </div>
            <div class="dock-icon" data-app="ThunderTV" onclick="createNewWindow('thundertv')">
                <img src="ThunderOs Apps/thundertv.png">
            </div>
            <div class="dock-icon" onclick="window.location.href='./mousefuzzy.html'">
                <img src="./mousefuzzy.png">
            </div>
        </div>
    </div>

    <input type="file" id="backgroundInput" accept="image/*" style="display: none;">
    <script>
const cryptos = [
    { name: 'Bitcoin', symbol: 'BTC', logo: 'https://cryptologos.cc/logos/bitcoin-btc-logo.png' },
    { name: 'Ethereum', symbol: 'ETH', logo: 'https://cryptologos.cc/logos/ethereum-eth-logo.png' },
    { name: 'Dogecoin', symbol: 'DOGE', logo: 'https://cryptologos.cc/logos/dogecoin-doge-logo.png' },
    { name: 'Cardano', symbol: 'ADA', logo: 'https://cryptologos.cc/logos/cardano-ada-logo.png' },
    { name: 'Polkadot', symbol: 'DOT', logo: 'https://cryptologos.cc/logos/polkadot-new-dot-logo.png' }
];

function getRandomCryptos(n) {
    return cryptos.sort(() => 0.5 - Math.random()).slice(0, n);
}        
function updateCryptoPrices() {
    const cryptoWidget = document.getElementById('crypto-widget');
    const selectedCryptos = getRandomCryptos(3);
    const symbols = selectedCryptos.map(crypto => crypto.symbol).join(',');

    fetch(`https://min-api.cryptocompare.com/data/pricemulti?fsyms=${symbols}&tsyms=USD`)
        .then(response => response.json())
        .then(data => {
            cryptoWidget.innerHTML = selectedCryptos.map(crypto => `
                <div class="crypto-item">
                    <img src="${crypto.logo}" alt="${crypto.name}" class="crypto-logo">
                    <span class="crypto-name">${crypto.name}</span>
                    <span class="crypto-price">$${data[crypto.symbol].USD.toFixed(2)}</span>
                </div>
            `).join('');
        })
        .catch(error => {
            console.error('Error fetching crypto prices:', error);
            cryptoWidget.innerHTML = '<p>Unable to fetch crypto prices</p>';
        });
}

window.addEventListener('load', updateCryptoPrices);

let windows = [];
let zIndex = 100;

function initDragAndDrop() {
    const dock = document.querySelector('.dock');
    const draggables = document.querySelectorAll('.dock-icon');

    draggables.forEach(draggable => {
        draggable.setAttribute('draggable', 'true');
        draggable.addEventListener('dragstart', dragStart);
        draggable.addEventListener('dragend', dragEnd);
    });

    dock.addEventListener('dragover', dragOver);
    dock.addEventListener('drop', drop);
}

function dragStart() {
    this.classList.add('dragging');
}

function dragEnd() {
    this.classList.remove('dragging');
}

function dragOver(e) {
    e.preventDefault();
}

function drop(e) {
    e.preventDefault();
    const draggingElement = document.querySelector('.dragging');
    const afterElement = getDragAfterElement(this, e.clientX);
    
    if (afterElement == null) {
        this.appendChild(draggingElement);
    } else {
        this.insertBefore(draggingElement, afterElement);
    }

    saveDockPositions();
}

function getDragAfterElement(container, x) {
    const draggableElements = [...container.querySelectorAll('.dock-icon:not(.dragging)')];

    return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = x - box.left - box.width / 2;
        if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
        } else {
            return closest;
        }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
}

function saveDockPositions() {
    const dockIcons = document.querySelectorAll('.dock-icon');
    const positions = Array.from(dockIcons).map(icon => icon.dataset.app); // Récupérer les noms des applications
    localStorage.setItem('dockPositions', JSON.stringify(positions)); // Enregistrer dans le stockage local
}

function loadDockPositions() {
    const savedPositions = JSON.parse(localStorage.getItem('dockPositions'));
    
    if (savedPositions) {
        const dock = document.querySelector('.dock');
        savedPositions.forEach(appName => {
            const icon = dock.querySelector(`.dock-icon[data-app="${appName}"]`);
            if (icon) {
                dock.appendChild(icon); // Réorganiser les icônes selon l'ordre sauvegardé
            }
        });
    }
}

// Appelez cette fonction au chargement de la page
window.addEventListener('load', () => {
    initDragAndDrop();
    loadDockPositions(); // Charger les positions sauvegardées
});


function createNewWindow(appName) {
    const existingWindow = Array.from(document.querySelectorAll('.window')).find(w => w.dataset.app === appName);
    if (existingWindow) {
        restoreWindow(appName);
        return;
    const newWindow = document.createElement('div');
    newWindow.className = 'window';
    newWindow.id = `window-${Date.now()}`;
    newWindow.dataset.app = appName;
    newWindow.style.zIndex = zIndex++;

    let iframeSrc;

    switch(appName) {
        case 'voltai':
            iframeSrc = 'ThunderOs\ Apps/voltai/index.html';
            break;
        case 'discord':
            iframeSrc = './app/discord.html';
            break;
        case 'appshop':
            iframeSrc = 'https://raw.githack.com/Shadowolfofficial/appshop/main/app.html';
            break;
        case 'information':
            iframeSrc = 'Information.html';
            break;
        case 'thunderbrows':
            iframeSrc = 'https://raw.githack.com/Shadowolfofficial/appshop/main/thunderbrows.html';
            break;
        case 'thundertv':
            iframeSrc = './thundertv.html';
            break;
        case 'myinstants':
            iframeSrc = 'https://raw.githack.com/Shadowolfofficial/appshop/main/thunderbrows.html?baseUrl=my1';
            break;
            case 'ubgdroid':
            iframeSrc = 'https://raw.githack.com/Shadowolfofficial/appshop/main/ubgdr0id.html';
            break;
        case 'settings':
            newWindow.innerHTML = `
                <div class="window-header">
                    <div class="window-buttons">
                        <div class="button close"></div>
                        <div class="button minimize"></div>
                        <div class="button maximize"></div>
                    </div>
                    <span>Paramètres</span>
                </div>
                <div class="window-content settings-content">
                    <h2>Paramètres</h2>
                    <h3>Sécurité des applications</h3>
                    <label for="app-security">Activer la sécurité</label>
                    <input type="checkbox" id="app-security" onchange="toggleAppSecurity()">
                    <input type="password" id="security-code" placeholder="Code de sécurité" style="display:none;">
                    <button id="save-security-code" style="display:none;" onclick="saveSecurityCode()">Sauvegarder le code</button>
                    <h3>Personnalisation</h3>
                    <label for="dockColor">Couleur du Dock:</label>
                    <input type="color" id="dockColor" onchange="changeDockColor(this.value)">
                    <h3>Réinitialisation</h3>
                    <button onclick="resetLocalStorage()">Réinitialiser les paramètres</button>
                </div>
            `;
            break;
        default:
            iframeSrc = './blank.html';
    }


const dockIcons = document.querySelectorAll('.dock-icon'); // Sélectionnez toutes les icônes du dock

function updateDockDisplay() {
    const screenWidth = window.innerWidth;
    let maxIcons = 4; // Assurez-vous qu'au moins 4 icônes sont affichées

    // Déterminez le nombre maximum d'icônes à afficher en fonction de la largeur de l'écran
    if (screenWidth > 1200) {
        maxIcons = Math.max(4, dockIcons.length); // Afficher au moins 4 icônes pour les grands écrans
    } else if (screenWidth > 800) {
        maxIcons = Math.max(3, dockIcons.length); // Afficher au moins 3 icônes pour les écrans moyens
    } else {
        maxIcons = Math.max(1, dockIcons.length); // Afficher au moins 1 icône pour les petits écrans
    }

    // Masquez toutes les icônes et affichez uniquement celles qui doivent être visibles
    dockIcons.forEach((icon, index) => {
        if (index < maxIcons) {
            icon.style.display = 'flex'; // Afficher l'icône
        } else {
            icon.style.display = 'none'; // Masquer l'icône
        }
    });
}

// Mettez à jour l'affichage du dock lors du chargement de la page et lors du redimensionnement de la fenêtre
window.addEventListener('load', updateDockDisplay);
window.addEventListener('resize', updateDockDisplay);


    if (appName !== 'settings') {
        newWindow.innerHTML += `
            <div class="window-header">
                <div class="window-buttons">
                    <div class="button close"></div>
                    <div class="button minimize"></div>
                    <div class="button maximize"></div>
                </div>
                <span>${appName.charAt(0).toUpperCase() + appName.slice(1)}</span>
            </div>
            <div class="window-content">
                <iframe src="${iframeSrc}" sandbox="allow-forms allow-modals allow-scripts allow-same-origin allow-downloads" frameborder="0" allowfullscreen></iframe>
            </div>`;
        
        checkAppSecurity(newWindow); // Vérifier la sécurité lors de l'ouverture d'une application
    }

    document.body.appendChild(newWindow);
    windows.push(newWindow);
    
    makeWindowDraggable(newWindow);
    setupWindowControls(newWindow);

    if (appName === "settings") updateSecuritySettings();
}

const dockIcons = document.querySelectorAll('.dock-icon'); // Sélectionnez toutes les icônes du dock
function updateDockDisplay() {
    const screenWidth = window.innerWidth;
    let minIcons = 5; // Minimum d'icônes à afficher

    // Affichez toutes les icônes si l'écran est assez large
    if (screenWidth > 800) {
        dockIcons.forEach(icon => {
            icon.style.display = 'flex'; // Afficher toutes les icônes
        });
    } else {
        // Pour les écrans plus petits, afficher au moins 5 icônes
        dockIcons.forEach((icon, index) => {
            if (index < minIcons) {
                icon.style.display = 'flex'; // Afficher l'icône
            } else {
                icon.style.display = 'none'; // Masquer l'icône
            }
        });
    }
}

// Mettez à jour l'affichage du dock lors du chargement de la page et lors du redimensionnement de la fenêtre
window.addEventListener('load', updateDockDisplay);
window.addEventListener('resize', updateDockDisplay);

function toggleAppSecurity() {
    const isEnabled = document.getElementById('app-security').checked;
    
    localStorage.setItem('appSecurityEnabled', isEnabled);
    
    const securityCodeInput = document.getElementById("security-code");
    const saveButton = document.getElementById("save-security-code");
    
    if (isEnabled) {
        securityCodeInput.style.display = "block";
        saveButton.style.display = "block";
        
        if (!localStorage.getItem("securityCode")) {
            alert("Veuillez définir un code de sécurité.");
        }
        
    } else {
        securityCodeInput.style.display = "none";
        saveButton.style.display= "none";
        
        localStorage.removeItem("securityCode");
     }
}

function saveSecurityCode() {
     const codeInputValue=document.getElementById("security-code").value;
     if(codeInputValue){
         localStorage.setItem("securityCode", codeInputValue);
         alert("Code de sécurité sauvegardé.");
     } else{
         alert("Veuillez entrer un code valide.");
     }
 }

function resetLocalStorage() {
    if (confirm("Êtes-vous sûr de vouloir réinitialiser ThunderOs ? Cette action est irréversible.")) {
        localStorage.clear();
        alert("ThunderOs été réinitialisés. ThunderOs va redémarrer");
        location.reload();
    }
}

function updateSecuritySettings() {
     const isEnabled=localStorage.getItem("appSecurityEnabled") === "true";
     document.getElementById("app-security").checked=isEnabled;
     toggleAppSecurity(); // Met à jour l'affichage en fonction de l'état actuel
}

// Superposition de sécurité
function showSecurityOverlay(appWindow) {
    const overlay = document.createElement('div');
    overlay.className = 'security-overlay';
    
    overlay.innerHTML = `
        <div class="security-popup">
            <h3>Entrez le code de sécurité</h3>
            <input type="password" id="security-input" placeholder="Code de sécurité">
            <button onclick="checkSecurityCode('${appWindow.id}')">Valider</button>
            <button onclick="closeOverlay('${appWindow.id}')">Annuler</button>
        </div>`;
    
    appWindow.appendChild(overlay);
}

function closeOverlay(windowId) {
   const appWindow = document.getElementById(windowId);
   appWindow.querySelector('.security-overlay').remove();
}

function checkAppSecurity(appWindow) {
   if (localStorage.getItem('appSecurityEnabled') === 'true') {
       showSecurityOverlay(appWindow);
   }
}

function checkSecurityCode(windowId) {
    const inputValue = document.getElementById('security-input').value;
    const savedCode = localStorage.getItem('securityCode');
    
    if (inputValue === savedCode) {
        const appWindow = document.getElementById(windowId);
        appWindow.querySelector('.security-overlay').remove();
    } else {
        alert('Code incorrect. Accès refusé.');
    }
}

function forgotPassword() {
    if (confirm('Êtes-vous sûr ? ThunderOS va se réinitialiser.')) {
        localStorage.clear();
        alert('ThunderOS a été réinitialisé. Toutes les données ont été supprimées.');
        location.reload();
    }
}

// Horloge et date
const fonts = ['Arial', 'Helvetica', 'Times New Roman', 'Courier', 'Georgia'];
let currentFontIndex = 0;

function updateClockAndDate() {
    const now = new Date();
    const clock = document.getElementById('clock');
    const date = document.getElementById('date');

    clock.textContent = now.toLocaleTimeString();
    date.textContent = now.toLocaleDateString();
}

setInterval(updateClockAndDate, 1000);
updateClockAndDate();

document.querySelector('.clock-container').addEventListener('click', changeClockFont);
document.querySelector('.clock-container').addEventListener('dblclick', resetClockFont);

function changeClockFont() {
   const clockContainer = document.querySelector('.clock-container');

   currentFontIndex = (currentFontIndex + 1) % fonts.length;
   clockContainer.style.fontFamily = fonts[currentFontIndex];

   localStorage.setItem('clockFont', currentFontIndex);
}

function resetClockFont() {
   const clockContainer = document.querySelector('.clock-container');

   clockContainer.style.fontFamily = '';
   currentFontIndex = 0;

   localStorage.removeItem('clockFont');
}

// Couleur du dock
const colorIcon = document.getElementById('colorIcon');
const colorPicker = document.getElementById('colorPicker');

colorIcon.addEventListener('click', function(e) {
   e.stopPropagation();
   colorPicker.style.display = colorPicker.style.display === 'none' ? 'block' : 'none';
});

document.addEventListener('click', function(e) {
   if (e.target !== colorIcon && !colorIcon.contains(e.target)) {
       colorPicker.style.display = 'none';
   }
});

function changeDockColor(color) {
   document.querySelector('.taskbar').style.backgroundColor = color;
   localStorage.setItem('dockColor', color);
}

// Réinitialisation du dock et du fond d'écran
function resetDockAndWallpaper() {
   document.querySelector('.taskbar').style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
   document.body.style.backgroundImage = '';
   document.body.style.backgroundColor = 'gray';

   localStorage.removeItem('dockColor');
   localStorage.removeItem('customBackground');

   document.getElementById('dockColor').value = '#000000';
}

// Changement de fond d'écran
function changeBackground(event) {
   const file = event.target.files[0];

   if (file) {
       const reader = new FileReader();
       reader.onload = function(e) {
           document.body.style.backgroundImage = `url('${e.target.result}')`;
           document.body.style.backgroundSize = 'cover';
           document.body.style.backgroundPosition = 'center';
           localStorage.setItem('customBackground', e.target.result);
       };
       reader.readAsDataURL(file);
   }
}

document.getElementById('backgroundInput').addEventListener('change', changeBackground);

// Fonctionnalités de fenêtre
function makeWindowDraggable(windowElement) {
   const header = windowElement.querySelector('.window-header');
   let isDragging=false;
   let startX,startY;

   header.addEventListener('mousedown', startDragging);
   document.addEventListener('mousemove', drag);
   document.addEventListener('mouseup', stopDragging);

   function startDragging(e) {
       isDragging=true;
       startX=e.clientX-windowElement.offsetLeft;
       startY=e.clientY-windowElement.offsetTop;
       windowElement.style.zIndex=zIndex++;
   }

   function drag(e) {
       if (!isDragging)return;
       let newX=e.clientX-startX;
       let newY=e.clientY-startY;

       newX=Math.max(0,Math.min(newX,window.innerWidth-windowElement.offsetWidth));
       newY=Math.max(0,Math.min(newY,window.innerHeight-windowElement.offsetHeight));

       windowElement.style.left=`${newX}px`;
       windowElement.style.top=`${newY}px`;
   }

   function stopDragging() {
       isDragging=false;
   }
}

function setupWindowControls(windowElement) {
    const closeBtn = windowElement.querySelector('.close');
    const minimizeBtn = windowElement.querySelector('.minimize');
    const maximizeBtn = windowElement.querySelector('.maximize');

    closeBtn.onclick = () => { 
        windowElement.remove(); 
        windows = windows.filter(w => w !== windowElement);
        updateDockIndicators();
    };

    minimizeBtn.onclick = () => { 
        windowElement.style.display = 'none'; 
        updateDockIndicators();
    };

    let isMaximized = false; 
   
    maximizeBtn.onclick = () => {
        if (isMaximized) {
            windowElement.style.width = '80%'; 
            windowElement.style.height = '80%'; 
            windowElement.style.top = '10%'; 
            windowElement.style.left = '10%'; 
        } else {
            windowElement.style.width = '100%'; 
            windowElement.style.height = 'calc(100% - 70px)';
            windowElement.style.top = '0'; 
            windowElement.style.left = '0'; 
        }
        isMaximized = !isMaximized;
    };
}

function restoreWindow(appName) {
    const windows = document.querySelectorAll('.window');
    windows.forEach(window => {
        if (window.dataset.app === appName) {
            window.style.display = 'flex'; // Affiche à nouveau la fenêtre
        }
    });
    updateDockIndicators();
}
        
// Chargement des paramètres sauvegardés
window.onload=function(){
  // Charger les paramètres sauvegardés pour le dock et le fond d'écran
  const savedColor=localStorage.getItem('dockColor');
  if(savedColor){
      document.querySelector('.taskbar').style.backgroundColor=savedColor;
      document.getElementById('dockColor').value=savedColor;
  }

  const customBackground=localStorage.getItem('customBackground');
  if(customBackground){
      document.body.style.backgroundImage=`url('${customBackground}')`;
      document.body.style.backgroundRepeat='no-repeat';
      document.body.style.backgroundSize='cover';
      document.body.style.backgroundPosition='center';
  }

  // Load saved font for the clock
  const savedFontIndex=localStorage.getItem('clockFont');
  if(savedFontIndex!==null){
      currentFontIndex=parseInt(savedFontIndex);
      document.querySelector('.clock-container').style.fontFamily=fonts[currentFontIndex];
  }
};

// Double-click to change background
document.body.addEventListener('dblclick', function(e) {
if (e.target === document.body) { 
     // Trigger file input click to change background image
     document.getElementById('backgroundInput').click(); 
}
});
</script>
</body>
</html>
